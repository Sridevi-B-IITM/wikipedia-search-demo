<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wikipedia Search with History</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .search-card { position: sticky; top: 1rem; z-index: 100; }
    .snippet { color: #495057; }
    .results-card { border: none; }
    .results-card .card-body { padding-bottom: 0.75rem; }
    .history-item-btn { text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <span class="navbar-brand">Wikipedia Search</span>
    </div>
  </nav>

  <main class="container my-4">
    <div class="row g-4">
      <div class="col-lg-8">
        <div class="card shadow-sm search-card">
          <div class="card-body">
            <form id="searchForm" class="row g-2 align-items-center">
              <div class="col-sm-9 col-12">
                <label for="searchInput" class="form-label mb-1">Search Wikipedia</label>
                <input id="searchInput" type="text" class="form-control form-control-lg" placeholder="e.g., JavaScript, SpaceX, Marie Curie" required />
              </div>
              <div class="col-sm-3 col-12 d-grid">
                <button class="btn btn-primary btn-lg mt-sm-4 mt-2" type="submit">Search</button>
              </div>
            </form>
          </div>
        </div>

        <div class="mt-4">
          <div id="resultsHeader" class="d-none mb-2">
            <h5 class="mb-0">Results</h5>
            <small id="resultsMeta" class="text-muted"></small>
          </div>
          <div id="resultsContainer" class="d-grid gap-3"></div>
          <div id="emptyState" class="text-center text-muted mt-4">
            <p class="mb-1">Start by searching a topic above.</p>
            <small>Tip: Click a topic in your history to quickly search again.</small>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card shadow-sm">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span>Search History</span>
            <button id="clearHistoryBtn" type="button" class="btn btn-sm btn-outline-danger">Clear</button>
          </div>
          <div class="card-body p-0">
            <ul id="historyList" class="list-group list-group-flush">
              <!-- History items inserted here -->
            </ul>
            <div id="noHistory" class="p-3 text-muted text-center">No recent topics.</div>
          </div>
          <div class="card-footer">
            <small class="text-muted">Shows your last 5 unique searches.</small>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="container my-4 text-center text-muted">
    <small>Results via Wikipedia API</small>
  </footer>

  <script>
    const API_URL = 'https://en.wikipedia.org/w/api.php?origin=*&action=query&list=search&format=json&srprop=snippet&utf8=1&srlimit=10&srsearch=';

    const searchForm = document.getElementById('searchForm');
    const searchInput = document.getElementById('searchInput');
    const resultsContainer = document.getElementById('resultsContainer');
    const resultsHeader = document.getElementById('resultsHeader');
    const resultsMeta = document.getElementById('resultsMeta');
    const emptyState = document.getElementById('emptyState');

    const historyList = document.getElementById('historyList');
    const clearHistoryBtn = document.getElementById('clearHistoryBtn');
    const noHistory = document.getElementById('noHistory');

    let history = loadHistory();

    function loadHistory() {
      try {
        const raw = localStorage.getItem('wikiHistory');
        return raw ? JSON.parse(raw) : [];
      } catch {
        return [];
      }
    }

    function saveHistory() {
      localStorage.setItem('wikiHistory', JSON.stringify(history));
    }

    function renderHistory() {
      historyList.innerHTML = '';
      if (!history.length) {
        noHistory.classList.remove('d-none');
      } else {
        noHistory.classList.add('d-none');
      }
      history.slice(0, 5).forEach(term => {
        const li = document.createElement('li');
        li.className = 'list-group-item p-0';
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'btn btn-link w-100 text-start history-item-btn px-3 py-2';
        btn.textContent = term;
        btn.title = term;
        btn.addEventListener('click', () => {
          searchInput.value = term;
          performSearch(term);
          addToHistory(term); // move to front
        });
        li.appendChild(btn);
        historyList.appendChild(li);
      });
      clearHistoryBtn.disabled = history.length === 0;
    }

    function addToHistory(term) {
      term = term.trim();
      if (!term) return;
      // Remove if exists and add to front
      history = [term, ...history.filter(t => t.toLowerCase() !== term.toLowerCase())];
      // Limit to 5
      history = history.slice(0, 5);
      saveHistory();
      renderHistory();
    }

    async function performSearch(query) {
      const q = query.trim();
      if (!q) return;

      resultsHeader.classList.remove('d-none');
      emptyState.classList.add('d-none');
      resultsMeta.textContent = 'Searching…';
      resultsContainer.innerHTML = `
        <div class="card results-card shadow-sm">
          <div class="card-body">
            <div class="placeholder-glow">
              <span class="placeholder col-7"></span>
              <span class="placeholder col-4"></span>
              <span class="placeholder col-4"></span>
              <span class="placeholder col-6"></span>
              <span class="placeholder col-8"></span>
            </div>
          </div>
        </div>
      `;

      try {
        const res = await fetch(API_URL + encodeURIComponent(q));
        if (!res.ok) throw new Error('Network error');
        const data = await res.json();
        const results = (data?.query?.search) || [];

        resultsMeta.textContent = `${results.length} result(s) for "${q}"`;
        renderResults(results);
      } catch (err) {
        resultsMeta.textContent = 'Error fetching results.';
        resultsContainer.innerHTML = `
          <div class="alert alert-danger" role="alert">
            Something went wrong. Please try again.
          </div>
        `;
      }
    }

    function renderResults(results) {
      resultsContainer.innerHTML = '';
      if (!results.length) {
        resultsContainer.innerHTML = `
          <div class="card shadow-sm">
            <div class="card-body">
              <p class="mb-0">No results found. Try a different query.</p>
            </div>
          </div>
        `;
        return;
      }

      results.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card shadow-sm results-card';

        const body = document.createElement('div');
        body.className = 'card-body';

        const title = document.createElement('h5');
        title.className = 'card-title mb-1';
        title.textContent = item.title;

        const snippet = document.createElement('p');
        snippet.className = 'card-text snippet';
        snippet.innerHTML = item.snippet + '…';

        const link = document.createElement('a');
        link.href = `https://en.wikipedia.org/?curid=${item.pageid}`;
        link.target = '_blank';
        link.rel = 'noopener noreferrer';
        link.className = 'btn btn-outline-primary btn-sm mt-2';
        link.textContent = 'Read on Wikipedia';

        body.appendChild(title);
        body.appendChild(snippet);
        body.appendChild(link);
        card.appendChild(body);
        resultsContainer.appendChild(card);
      });
    }

    searchForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const term = searchInput.value.trim();
      if (!term) return;
      addToHistory(term);
      performSearch(term);
    });

    clearHistoryBtn.addEventListener('click', () => {
      if (!history.length) return;
      history = [];
      saveHistory();
      renderHistory();
    });

    // Initial render
    renderHistory();

    // Optional: If there is history, show last searched results immediately
    if (history.length) {
      searchInput.value = history[0];
      performSearch(history[0]);
    }
  </script>
</body>
</html>